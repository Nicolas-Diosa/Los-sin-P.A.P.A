<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parchate · Materias y eventos</title>
<style>
  @font-face{font-family:"Tokyo";src:url("Tokyo.ttf") format("truetype");font-display:swap}
  :root{
    --primary:#FCAF56; --secondary:#7795FC;
    --g0:#fff; --g50:#f9fafb; --g100:#f3f4f6; --g200:#e5e7eb; --g300:#d1d5db; --g600:#4b5563; --g900:#111827;
    --ring:0 0 0 3px rgba(119,149,252,.35); --shadow:0 10px 24px rgba(0,0,0,.12);
    --touch:44px; --radius:16px;
    --p-alta:#FCA5A5; --p-media:#FCD34D; --p-baja:#A7F3D0;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--g50);color:var(--g900);font:16px/1.5 "Tokyo",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .app{min-height:100dvh;display:grid;grid-template-rows:auto 1fr}
  header{position:sticky;top:0;z-index:10;background:var(--g0);border-bottom:1px solid var(--g200)}
  .head{max-width:1100px;margin:auto;padding:10px 16px;height:64px;display:flex;align-items:center;gap:12px}
  .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--secondary))}
  .title{font-weight:900;color:var(--secondary)}
  .container{max-width:1100px;margin:auto;padding:16px}

  .layout{display:grid;gap:16px}
  @media (min-width:900px){ .layout{grid-template-columns:2fr 1fr} }

  .panel{background:var(--g0);border:1px solid var(--g200);border-radius:var(--radius);padding:14px;box-shadow:0 1px 2px rgba(0,0,0,.05)}
  .list{display:grid;gap:10px}
  .item{display:grid;gap:6px;border:1px solid var(--g200);border-radius:12px;padding:10px;background:var(--g0)}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .meta{color:var(--g600)}
  .dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:8px}
  .alta{background:var(--p-alta)} .media{background:var(--p-media)} .baja{background:var(--p-baja)}

  .btn{min-height:var(--touch);padding:12px 18px;border-radius:14px;border:1px solid transparent;font-weight:800;cursor:pointer}
  .btn:focus-visible{outline:none;box-shadow:var(--ring)}
  .btn-primary{background:var(--primary);color:#111}
  .btn-secondary{background:var(--g0);border:1px solid var(--g300)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}

  .sr-only{position:absolute;width:1px;height:1px;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;padding:0}
</style>
</head>
<body>
  <div class="app">
    <header role="banner">
      <div class="head">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">Elegir materia o evento</div>
      </div>
    </header>

    <main class="container" role="main">
      <div class="layout">
        <!-- Lista de eventos/materias -->
        <section class="panel" aria-labelledby="list-title">
          <h2 id="list-title" style="margin-top:0">Eventos y materias</h2>
          <div id="list" class="list" role="list"></div>
          <p class="meta" style="margin-top:10px">
            Selecciona uno para habilitar <b>“Eliminar Materia o evento”</b>.
          </p>
        </section>

        <!-- Resumen y acción -->
        <aside class="panel" aria-labelledby="sel-title">
          <h2 id="sel-title" style="margin-top:0">Seleccionado</h2>
          <div id="summary" class="meta">Ninguno</div>
          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
            <div class="actions">
                <form action="/materias_y_eventos/" method="POST" style="display:inline;" class="eliminar-mat-form">
                    {% csrf_token %}
                    <input type="hidden" id="elemento_a_eliminar" name="elemento_a_eliminar" value="">
                    <input type="hidden" id="tipo_elemento" name="tipo_elemento" value="">
                    <button id="EliminarElemento" class="btn btn-primary" type="submit" disabled aria-disabled="true">Eliminar Materia o Evento</button>
                </form>
            </div>
            <a class="btn btn-secondary" href="/calendario/" aria-label="Volver al calendario">Volver al calendario</a>
          </div>
        </aside>
      </div>
    </main>
  </div>

<script>
  const KEY='parchate_calendar';
  const $=s=>document.querySelector(s);
  const prioridadNombres = {1: 'Baja', 2: 'Media', 3: 'Alta'};
  const elementos_json = '{{ elementos_json|escapejs }}';
  function get(){ try{ return JSON.parse(elementos_json)||[] }catch{ return [] } }

  const list=$('#list'), summary=$('#summary'), addBtn=$('#addBtn');
  let selected=null;

  function prLabel(p){ return p==='alta'?'Alta':p==='media'?'Media':'Baja'; }
  function prDot(p){ return `<span class="dot ${p}"></span>`; }
  const DAY = ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'];

  function render(){
    const items=get();
    list.innerHTML='';
    if(!items.length){
      list.innerHTML='<div class="item" role="listitem"><strong>No hay eventos/materias.</strong><div class="meta">Crea uno en el calendario.</div></div>';
      return;
    }
    items.forEach(ev=>{
      const el=document.createElement('label');
      el.className='item'; el.setAttribute('role','listitem'); el.tabIndex=0;
      el.innerHTML=`
        <div class="row">
          <strong>${ev.name}</strong>
          <span class="meta">${prioridadNombres[ev.prioridad]}</span>
        </div>
        <div class="row">
          <span class="meta">Tipo: ${ev.type}</span>
          <input type="radio" name="pick" value="${ev.id}" aria-label="Seleccionar ${ev.name}" />
        </div>
      `;
      el.addEventListener('click', (e)=>{
        // Evitar doble toggle si se pulsa el radio
        if(e.target.tagName!=='INPUT'){
          el.querySelector('input[type="radio"]').checked = true;
        }
        onPick(ev);
      });
      list.appendChild(el);
    });
  }

  function onPick(ev){
    selected=ev;
    if(ev.type=='evento'){
        summary.innerHTML = `
        <div><strong>${ev.name}</strong></div>
        <div class="meta">${prDot(ev.priority)}${prLabel(ev.priority)} · ${ev.type} · ${ev.start.substring(0,10)}  /  ${ev.end.substring(0,10)}</div>
        `;
    }
    else{
        summary.innerHTML = `
        <div><strong>${ev.name}</strong></div>
        <div class="meta">${prDot(ev.priority)}${prLabel(ev.priority)} · ${ev.type} · ${ev.horario}</div>
        `;
    }
    elemento_a_eliminar.value = ev.id;
    tipo_elemento.value = ev.type
    EliminarElemento.removeAttribute('aria-disabled');
    EliminarElemento.removeAttribute('disabled');
  }


  render();
</script>
</body>
</html>